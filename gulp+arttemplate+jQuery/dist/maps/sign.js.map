{"version":3,"sources":["sign.js"],"names":["signMoudle","setSignEnable","enable","$","removeClass","addClass","hide","show","hasClass","renderGou","resp","html","data","keepSignDays","totalSigninNum","signin","signinList","i","length","signCalander","day","gifGold","reflushBtn","signBtn","attr","console","log","click","isSigned","signed","ajax","url","Urls","isSignToday","type","async","cache","dataType","xhrFields","withCredentials","crossDomain","success","signToday","Util","popup","textUp","error","signSuccessHandler","signing","query","showMsg","signTimeout","setTimeout","clearTimeout","renderSignPanel","template","$body","append","year","month","gou","path","on","find","remove","this","language","osType","moudle","urlConfig"],"mappings":"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","file":"../js/sign.js","sourcesContent":["/**\r\n * 签到。\r\n * Created by Administrator on 2017/3/14.\r\n */\r\nvar signMoudle = (function(){\r\n    var path = moudle.urlConfig.url;\r\n    var Urls = {\r\n        query: path + 'api/sign/list',\r\n        signin: path + 'api/sign/signin',\r\n        isSignToday: path + 'api/sign/has-sign-today'\r\n    };\r\n\r\n    var signing = false;\r\n    var $body = $('body');\r\n    var signBtn = $('#sign-bar-btn');\r\n    var signTimeout = null;\r\n\r\n    /**\r\n     * 签到按钮是否可用，\r\n     * ---------------------------\r\n     * @param enable true是, false否\r\n     */\r\n    function setSignEnable(enable) {\r\n        if (enable) {\r\n            $('.act_sign_box .sign_btn').removeClass('yet');\r\n            $('.act_sign_box .sign_btn .sign_yet_img').addClass('hide');\r\n            $('.act_sign_box .sign_btn .sign_yet_img').hide();\r\n            $('.act_sign_box .sign_btn .sign_img').removeClass('hide');\r\n            $('.act_sign_box .sign_btn .sign_img').show();\r\n        } else {\r\n            if (!$('.act_sign_box .sign_btn').hasClass('yet')) {\r\n                $('.act_sign_box .sign_btn').addClass('yet');\r\n            }\r\n\r\n            $('.act_sign_box .sign_btn .sign_img').hide();\r\n            $('.act_sign_box .sign_btn .sign_yet_img').show();\r\n            $('.act_sign_box .sign_btn .sign_yet_img').removeClass('hide');\r\n            $('.act_sign_box .sign_btn .sign_img').addClass('hide');\r\n        }\r\n    }\r\n\r\n    function renderGou(resp){\r\n        $('#keepSignDays').html(resp.data.keepSignDays);\r\n        $('#totalSigninNum').html(resp.data.totalSigninNum);\r\n\r\n        // 签到天打勾，并显示金币\r\n        var signinList = resp.data.signinList;\r\n        var signin;\r\n        for (var i = 0; i < signinList.length; i++) {\r\n            signin = signinList[i];\r\n            $('.calendar').signCalander(\"setCoin\", signin.day, signin.gifGold);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 刷新金币\r\n     */\r\n    function reflushBtn() {\r\n        signBtn.html('已签到').attr('disable', 'disable');\r\n        console.log(33333333333)\r\n        $('.icon_head_fresh ').click();\r\n    }\r\n\r\n    /**\r\n     * 今天是否已经签到\r\n     */\r\n    function isSigned() {\r\n        var signed = false;\r\n\r\n        $.ajax({\r\n            url: Urls.isSignToday,\r\n            type: 'post',\r\n            async: false,\r\n            cache: false,\r\n            dataType: 'json',\r\n            xhrFields: {\r\n                withCredentials: true\r\n            },\r\n            crossDomain: true,\r\n            success: function (resp) {\r\n            \tconsole.log(resp)\r\n                if (resp.data.signToday >= 1) {\r\n                    signed = true;\r\n                    Util.popup.textUp('今天已签到');\r\n                    reflushBtn();\r\n                }\r\n            },\r\n            error: function () {\r\n            }\r\n        });\r\n\r\n        return signed;\r\n    }\r\n\r\n    /**\r\n     *  签到成功处理。\r\n     * @param resp\r\n     */\r\n    function signSuccessHandler(resp){\r\n        signing = false;\r\n        setSignEnable(false);\r\n\r\n        if (resp.data > 0) {\r\n            Util.popup.textUp('已签到成功，获得+' + resp.data + '金币');\r\n\r\n            $.ajax({\r\n                url: Urls.query,\r\n                type: 'post',\r\n                async: false,\r\n                cache: false,\r\n                dataType: 'json',\r\n                xhrFields: {\r\n                    withCredentials: true\r\n                },\r\n                crossDomain: true,\r\n                success: function (resp) {\r\n                    renderGou(resp);\r\n                    reflushBtn();\r\n                },\r\n                error: function () {\r\n                }\r\n            });\r\n\r\n\t\t\t/*$.post(Urls.query, {\r\n\t\t\t xhrFields: {\r\n\t\t\t withCredentials: true\r\n\t\t\t },\r\n\t\t\t crossDomain: true\r\n\t\t\t }, function (resp) {\r\n\t\t\t renderGou(resp);\r\n\t\t\t reflushBtn();\r\n\t\t\t }, 'json');*/\r\n\r\n        } else {\r\n            Util.popup.textUp('今天已签到');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 当天已经签到直接提示，防冒泡。\r\n     * ---------------------------------------\r\n     */\r\n    function showMsg() {\r\n        if (signing) {\r\n            return;\r\n        }\r\n\r\n        signing = true;\r\n        Util.popup.textUp('今日已签到');\r\n\r\n        // 防冒泡\r\n        signTimeout = setTimeout(function () {\r\n            signing = false;\r\n            clearTimeout(signTimeout);\r\n        }, 2000);\r\n    }\r\n\r\n    /**\r\n     *  渲染签到面板。\r\n     *  ---------------------------------------\r\n     * @param resp\r\n     */\r\n    function renderSignPanel(resp) {\r\n    \tconsole.log(resp)\r\n        signing = true;\r\n\r\n        var html = template('sign', resp.data);\r\n        $body.append(html);\r\n\r\n        // 活动栏，重新加载\r\n        // getMenuIsPublic();\r\n\r\n        // 当天已经签到\r\n        setSignEnable(resp.data.signToday <= 0);\r\n\r\n        $('.calendar').signCalander({\r\n            year: resp.data.year,\r\n            month: resp.data.month - 1,\r\n            gou: path + '../images/sign_ca/ca_gou.png'\r\n        });\r\n\r\n        renderGou(resp);\r\n\r\n        // 关闭按钮\r\n        $body.on('click', '.act_close', function () {\r\n            signing = false;\r\n            $body.find(\".act_sign_box\").remove();\r\n            $body.find(\".act_sign_mask\").remove();\r\n        });\r\n\r\n        // 签到按钮\r\n        $body.on('click', '.act_sign_box .sign_btn', function () {\r\n            if ($(this).hasClass('yet')){\r\n                showMsg();\r\n                return;\r\n            }\r\n\r\n            $(this).addClass('yet');\r\n\r\n            $.ajax({\r\n                    url: Urls.signin,\r\n                    data: {'language': 'zh_CN', osType: 'pc'},\r\n                    type: 'post',\r\n                    async: false,\r\n                    cache: false,\r\n                    dataType: 'json',\r\n                    xhrFields: {\r\n                        withCredentials: true\r\n                    },\r\n                    crossDomain: true,\r\n                    success: signSuccessHandler,\r\n                    error: function () {\r\n                        $(this).removeClass('yet');\r\n                        Util.popup.textUp(\"签到失败！\");\r\n                    }\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    return {\r\n        renderSignPanel: renderSignPanel,\r\n        renderGou: renderGou,\r\n        isSigned: isSigned\r\n    }\r\n})()"]}