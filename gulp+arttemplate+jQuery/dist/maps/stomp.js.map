{"version":3,"sources":["stomp.js"],"names":["Byte","Client","Frame","Stomp","__hasProp","hasOwnProperty","LF","NULL","command","headers","body","this","prototype","toString","lines","name","value","_ref","call","push","length","join","_unmarshallSingle","data","chr","divider","headerLines","i","idx","len","line","start","trim","_i","_j","_ref1","search","RegExp","substring","split","shift","str","replace","indexOf","parseInt","charAt","unmarshall","datas","_len","_results","marshall","frame","ws","binaryType","counter","connected","heartbeat","outgoing","incoming","subscriptions","_transmit","out","debug","send","_setupHeartbeat","serverIncoming","serverOutgoing","ttl","v","_this","version","VERSIONS","V1_1","V1_2","Math","max","pinger","window","setInterval","ponger","delta","Date","now","serverActivity","close","connect","login","passcode","connectCallback","errorCallback","vhost","onmessage","evt","arr","c","onreceive","ArrayBuffer","Uint8Array","String","fromCharCode","server","subscription","onreceipt","onclose","msg","url","_cleanUp","onopen","accept-version","supportedVersions","heart-beat","host","disconnect","disconnectCallback","clearInterval","destination","subscribe","callback","id","unsubscribe","begin","transaction","commit","abort","ack","messageID","nack","libVersion","V1_0","client","protocols","klass","WebSocketClass","WebSocket","over","exports","require","StompServerMock","self"],"mappings":"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","file":"../js/stomp.js","sourcesContent":["// Generated by CoffeeScript 1.4.0\r\n(function() {\r\n  var Byte, Client, Frame, Stomp,\r\n    __hasProp = {}.hasOwnProperty;\r\n\r\n  Byte = {\r\n    LF: '\\x0A',\r\n    NULL: '\\x00'\r\n  };\r\n\r\n  Frame = (function() {\r\n\r\n    function Frame(command, headers, body) {\r\n      this.command = command;\r\n      this.headers = headers != null ? headers : {};\r\n      this.body = body != null ? body : '';\r\n    }\r\n\r\n    Frame.prototype.toString = function() {\r\n      var lines, name, value, _ref;\r\n      lines = [this.command];\r\n      _ref = this.headers;\r\n      for (name in _ref) {\r\n        if (!__hasProp.call(_ref, name)) continue;\r\n        value = _ref[name];\r\n        lines.push(\"\" + name + \":\" + value);\r\n      }\r\n      if (this.body) {\r\n        lines.push(\"content-length:\" + ('' + this.body).length);\r\n      }\r\n      lines.push(Byte.LF + this.body);\r\n      return lines.join(Byte.LF);\r\n    };\r\n\r\n    Frame._unmarshallSingle = function(data) {\r\n      var body, chr, command, divider, headerLines, headers, i, idx, len, line, start, trim, _i, _j, _ref, _ref1;\r\n      divider = data.search(RegExp(\"\" + Byte.LF + Byte.LF));\r\n      headerLines = data.substring(0, divider).split(Byte.LF);\r\n      command = headerLines.shift();\r\n      headers = {};\r\n      trim = function(str) {\r\n        return str.replace(/^\\s+|\\s+$/g, '');\r\n      };\r\n      line = idx = null;\r\n      for (i = _i = 0, _ref = headerLines.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n        line = headerLines[i];\r\n        idx = line.indexOf(':');\r\n        headers[trim(line.substring(0, idx))] = trim(line.substring(idx + 1));\r\n      }\r\n      body = '';\r\n      start = divider + 2;\r\n      if (headers['content-length']) {\r\n        len = parseInt(headers['content-length']);\r\n        body = ('' + data).substring(start, start + len);\r\n      } else {\r\n        chr = null;\r\n        for (i = _j = start, _ref1 = data.length; start <= _ref1 ? _j < _ref1 : _j > _ref1; i = start <= _ref1 ? ++_j : --_j) {\r\n          chr = data.charAt(i);\r\n          if (chr === Byte.NULL) {\r\n            break;\r\n          }\r\n          body += chr;\r\n        }\r\n      }\r\n      return new Frame(command, headers, body);\r\n    };\r\n\r\n    Frame.unmarshall = function(datas) {\r\n      var data;\r\n      return (function() {\r\n        var _i, _len, _ref, _results;\r\n        _ref = datas.split(RegExp(\"\" + Byte.NULL + Byte.LF + \"*\"));\r\n        _results = [];\r\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n          data = _ref[_i];\r\n          if ((data != null ? data.length : void 0) > 0) {\r\n            _results.push(Frame._unmarshallSingle(data));\r\n          }\r\n        }\r\n        return _results;\r\n      })();\r\n    };\r\n\r\n    Frame.marshall = function(command, headers, body) {\r\n      var frame;\r\n      frame = new Frame(command, headers, body);\r\n      return frame.toString() + Byte.NULL;\r\n    };\r\n\r\n    return Frame;\r\n\r\n  })();\r\n\r\n  Client = (function() {\r\n\r\n    function Client(ws) {\r\n      this.ws = ws;\r\n      this.ws.binaryType = \"arraybuffer\";\r\n      this.counter = 0;\r\n      this.connected = false;\r\n      this.heartbeat = {\r\n        outgoing: 10000,\r\n        incoming: 10000\r\n      };\r\n      this.subscriptions = {};\r\n    }\r\n\r\n    Client.prototype._transmit = function(command, headers, body) {\r\n      var out;\r\n      out = Frame.marshall(command, headers, body);\r\n      if (typeof this.debug === \"function\") {\r\n        this.debug(\">>> \" + out);\r\n      }\r\n      return this.ws.send(out);\r\n    };\r\n\r\n    Client.prototype._setupHeartbeat = function(headers) {\r\n      var serverIncoming, serverOutgoing, ttl, v, _ref, _ref1,\r\n        _this = this;\r\n      if ((_ref = headers.version) !== Stomp.VERSIONS.V1_1 && _ref !== Stomp.VERSIONS.V1_2) {\r\n        return;\r\n      }\r\n      _ref1 = (function() {\r\n        var _i, _len, _ref1, _results;\r\n        _ref1 = headers['heart-beat'].split(\",\");\r\n        _results = [];\r\n        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\r\n          v = _ref1[_i];\r\n          _results.push(parseInt(v));\r\n        }\r\n        return _results;\r\n      })(), serverOutgoing = _ref1[0], serverIncoming = _ref1[1];\r\n      if (!(this.heartbeat.outgoing === 0 || serverIncoming === 0)) {\r\n        ttl = Math.max(this.heartbeat.outgoing, serverIncoming);\r\n        if (typeof this.debug === \"function\") {\r\n          this.debug(\"send PING every \" + ttl + \"ms\");\r\n        }\r\n        this.pinger = typeof window !== \"undefined\" && window !== null ? window.setInterval(function() {\r\n          _this.ws.send(Byte.LF);\r\n          return typeof _this.debug === \"function\" ? _this.debug(\">>> PING\") : void 0;\r\n        }, ttl) : void 0;\r\n      }\r\n      if (!(this.heartbeat.incoming === 0 || serverOutgoing === 0)) {\r\n        ttl = Math.max(this.heartbeat.incoming, serverOutgoing);\r\n        if (typeof this.debug === \"function\") {\r\n          this.debug(\"check PONG every \" + ttl + \"ms\");\r\n        }\r\n        return this.ponger = typeof window !== \"undefined\" && window !== null ? window.setInterval(function() {\r\n          var delta;\r\n          delta = Date.now() - _this.serverActivity;\r\n          if (delta > ttl * 2) {\r\n            if (typeof _this.debug === \"function\") {\r\n              _this.debug(\"did not receive server activity for the last \" + delta + \"ms\");\r\n            }\r\n            return _this.ws.close();\r\n          }\r\n        }, ttl) : void 0;\r\n      }\r\n    };\r\n\r\n    Client.prototype.connect = function(login, passcode, connectCallback, errorCallback, vhost) {\r\n      login=\"guest\";\r\n      passcode=\"79OkSYaPPkPSGYkUIfL2/6BmhcQ/xoz\";\r\n      var _this = this;\r\n      this.connectCallback = connectCallback;\r\n      if (typeof this.debug === \"function\") {\r\n        this.debug(\"Opening Web Socket...\");\r\n      }\r\n      this.ws.onmessage = function(evt) {\r\n        var arr, c, data, frame, onreceive, _i, _len, _ref, _results;\r\n        data = typeof ArrayBuffer !== 'undefined' && evt.data instanceof ArrayBuffer ? (arr = new Uint8Array(evt.data), typeof _this.debug === \"function\" ? _this.debug(\"--- got data length: \" + arr.length) : void 0, ((function() {\r\n          var _i, _len, _results;\r\n          _results = [];\r\n          for (_i = 0, _len = arr.length; _i < _len; _i++) {\r\n            c = arr[_i];\r\n            _results.push(String.fromCharCode(c));\r\n          }\r\n          return _results;\r\n        })()).join('')) : evt.data;\r\n        _this.serverActivity = Date.now();\r\n        if (data === Byte.LF) {\r\n          if (typeof _this.debug === \"function\") {\r\n            _this.debug(\"<<< PONG\");\r\n          }\r\n          return;\r\n        }\r\n        if (typeof _this.debug === \"function\") {\r\n          _this.debug(\"<<< \" + data);\r\n        }\r\n        _ref = Frame.unmarshall(data);\r\n        _results = [];\r\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n          frame = _ref[_i];\r\n          switch (frame.command) {\r\n            case \"CONNECTED\":\r\n              if (typeof _this.debug === \"function\") {\r\n                _this.debug(\"connected to server \" + frame.headers.server);\r\n              }\r\n              _this.connected = true;\r\n              _this._setupHeartbeat(frame.headers);\r\n              _results.push(typeof _this.connectCallback === \"function\" ? _this.connectCallback(frame) : void 0);\r\n              break;\r\n            case \"MESSAGE\":\r\n              onreceive = _this.subscriptions[frame.headers.subscription];\r\n              _results.push(typeof onreceive === \"function\" ? onreceive(frame) : void 0);\r\n              break;\r\n            case \"RECEIPT\":\r\n              _results.push(typeof _this.onreceipt === \"function\" ? _this.onreceipt(frame) : void 0);\r\n              break;\r\n            case \"ERROR\":\r\n              _results.push(typeof errorCallback === \"function\" ? errorCallback(frame) : void 0);\r\n              break;\r\n            default:\r\n              _results.push(typeof _this.debug === \"function\" ? _this.debug(\"Unhandled frame: \" + frame) : void 0);\r\n          }\r\n        }\r\n        return _results;\r\n      };\r\n      this.ws.onclose = function() {\r\n        var msg;\r\n        msg = \"Whoops! Lost connection to \" + _this.ws.url;\r\n        if (typeof _this.debug === \"function\") {\r\n          _this.debug(msg);\r\n        }\r\n        _this._cleanUp();\r\n        return typeof errorCallback === \"function\" ? errorCallback(msg) : void 0;\r\n      };\r\n      return this.ws.onopen = function() {\r\n        var headers;\r\n        if (typeof _this.debug === \"function\") {\r\n          _this.debug('Web Socket Opened...');\r\n        }\r\n        headers = {\r\n          \"accept-version\": Stomp.VERSIONS.supportedVersions(),\r\n          \"heart-beat\": [_this.heartbeat.outgoing, _this.heartbeat.incoming].join(',')\r\n        };\r\n        if (vhost) {\r\n          headers.host = vhost;\r\n        }\r\n        if (login) {\r\n          headers.login = login;\r\n        }\r\n        if (passcode) {\r\n          headers.passcode = passcode;\r\n        }\r\n        return _this._transmit(\"CONNECT\", headers);\r\n      };\r\n    };\r\n\r\n    Client.prototype.disconnect = function(disconnectCallback) {\r\n      this._transmit(\"DISCONNECT\");\r\n      this.ws.onclose = null;\r\n      this.ws.close();\r\n      this._cleanUp();\r\n      return typeof disconnectCallback === \"function\" ? disconnectCallback() : void 0;\r\n    };\r\n\r\n    Client.prototype._cleanUp = function() {\r\n      this.connected = false;\r\n      if (this.pinger) {\r\n        if (typeof window !== \"undefined\" && window !== null) {\r\n          window.clearInterval(this.pinger);\r\n        }\r\n      }\r\n      if (this.ponger) {\r\n        return typeof window !== \"undefined\" && window !== null ? window.clearInterval(this.ponger) : void 0;\r\n      }\r\n    };\r\n\r\n    Client.prototype.send = function(destination, headers, body) {\r\n      if (headers == null) {\r\n        headers = {};\r\n      }\r\n      if (body == null) {\r\n        body = '';\r\n      }\r\n      headers.destination = destination;\r\n      return this._transmit(\"SEND\", headers, body);\r\n    };\r\n\r\n    Client.prototype.subscribe = function(destination, callback, headers) {\r\n      if (headers == null) {\r\n        headers = {};\r\n      }\r\n      if (!headers.id) {\r\n        headers.id = \"sub-\" + this.counter++;\r\n      }\r\n      headers.destination = destination;\r\n      this.subscriptions[headers.id] = callback;\r\n      this._transmit(\"SUBSCRIBE\", headers);\r\n      return headers.id;\r\n    };\r\n\r\n    Client.prototype.unsubscribe = function(id) {\r\n      delete this.subscriptions[id];\r\n      return this._transmit(\"UNSUBSCRIBE\", {\r\n        id: id\r\n      });\r\n    };\r\n\r\n    Client.prototype.begin = function(transaction) {\r\n      return this._transmit(\"BEGIN\", {\r\n        transaction: transaction\r\n      });\r\n    };\r\n\r\n    Client.prototype.commit = function(transaction) {\r\n      return this._transmit(\"COMMIT\", {\r\n        transaction: transaction\r\n      });\r\n    };\r\n\r\n    Client.prototype.abort = function(transaction) {\r\n      return this._transmit(\"ABORT\", {\r\n        transaction: transaction\r\n      });\r\n    };\r\n\r\n    Client.prototype.ack = function(messageID, subscription, headers) {\r\n      if (headers == null) {\r\n        headers = {};\r\n      }\r\n      headers[\"message-id\"] = messageID;\r\n      headers.subscription = subscription;\r\n      return this._transmit(\"ACK\", headers);\r\n    };\r\n\r\n    Client.prototype.nack = function(messageID, subscription, headers) {\r\n      if (headers == null) {\r\n        headers = {};\r\n      }\r\n      headers[\"message-id\"] = messageID;\r\n      headers.subscription = subscription;\r\n      return this._transmit(\"NACK\", headers);\r\n    };\r\n\r\n    return Client;\r\n\r\n  })();\r\n\r\n  Stomp = {\r\n    libVersion: \"2.0.0-next\",\r\n    VERSIONS: {\r\n      V1_0: '1.0',\r\n      V1_1: '1.1',\r\n      V1_2: '1.2',\r\n      supportedVersions: function() {\r\n        return '1.1,1.0';\r\n      }\r\n    },\r\n    client: function(url, protocols) {\r\n      var klass, ws;\r\n      if (protocols == null) {\r\n        protocols = ['v10.stomp', 'v11.stomp'];\r\n      }\r\n      klass = Stomp.WebSocketClass || WebSocket;\r\n      ws = new klass(url, protocols);\r\n      return new Client(ws);\r\n    },\r\n    over: function(ws) {\r\n      return new Client(ws);\r\n    },\r\n    Frame: Frame\r\n  };\r\n\r\n  if (typeof window !== \"undefined\" && window !== null) {\r\n    window.Stomp = Stomp;\r\n  } else if (typeof exports !== \"undefined\" && exports !== null) {\r\n    exports.Stomp = Stomp;\r\n    Stomp.WebSocketClass = require('./test/server.mock.js').StompServerMock;\r\n  } else {\r\n    self.Stomp = Stomp;\r\n  }\r\n\r\n}).call(this);\r\n"]}